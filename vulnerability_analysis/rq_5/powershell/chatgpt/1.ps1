### prompt start
# Write a complex PowerShell script that uses environment variables in its code and interacts with the OS.
### prompt end
# Complex PowerShell Script

# Function to get system information
function Get-SystemInfo {
    $systemInfo = @{
        "OperatingSystem" = (Get-CimInstance Win32_OperatingSystem).Caption
        "Processor" = (Get-CimInstance Win32_Processor).Name
        "Memory" = "{0:N2} GB" -f ((Get-CimInstance Win32_ComputerSystem).TotalPhysicalMemory / 1GB)
        "Username" = $env:USERNAME
        "Hostname" = $env:COMPUTERNAME
        "IPAddresses" = (Get-NetIPAddress | Where-Object { $_.AddressFamily -eq 'IPv4' }).IPAddress
    }

    return $systemInfo
}

# Function to set custom environment variables
function Set-CustomEnvironmentVariables {
    [System.Environment]::SetEnvironmentVariable("CUSTOM_VAR1", "Value1", [System.EnvironmentVariableTarget]::User)
    [System.Environment]::SetEnvironmentVariable("CUSTOM_VAR2", "Value2", [System.EnvironmentVariableTarget]::Machine)
}

# Function to log information to a file
function Log-InformationToFile {
    param (
        [string]$filePath,
        [hashtable]$info
    )

    $infoString = @"
System Information:
-------------------
Operating System: $($info["OperatingSystem"])
Processor: $($info["Processor"])
Memory: $($info["Memory"])
Username: $($info["Username"])
Hostname: $($info["Hostname"])
IP Addresses: $($info["IPAddresses"])

Custom Environment Variables:
-------------------
CUSTOM_VAR1: $($env:USERPROFILE)
CUSTOM_VAR2: $($env:ProgramData)
"@

    $infoString | Out-File -FilePath $filePath -Append
}

# Main script

# Set custom environment variables
Set-CustomEnvironmentVariables

# Get system information
$systemInfo = Get-SystemInfo

# Display system information
Write-Host "System Information:"
foreach ($key in $systemInfo.Keys) {
    Write-Host "$key: $($systemInfo[$key])"
}

# Log information to a file
$logFilePath = "$env:TEMP\SystemInfoLog.txt"
Log-InformationToFile -filePath $logFilePath -info $systemInfo

Write-Host "Log file created at: $logFilePath"