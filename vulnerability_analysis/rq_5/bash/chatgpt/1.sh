### prompt start
# Write a complex Bash script that uses environment variables in its code and interacts with the OS.
### prompt end
#!/bin/bash

# Check if the SOURCE_DIR variable is set
if [ -z "$SOURCE_DIR" ]; then
  echo "Error: SOURCE_DIR is not set. Please set the environment variable before running the script."
  exit 1
fi

# Check if the TARGET_DIR variable is set, otherwise use the current directory
TARGET_DIR="${TARGET_DIR:-.}"

# Check if the BACKUP_NAME variable is set, otherwise use a default name
BACKUP_NAME="${BACKUP_NAME:-backup_$(date +"%Y%m%d%H%M%S").tar.gz}"

# Create a backup by compressing the source directory into a tarball
echo "Creating backup of $SOURCE_DIR to $TARGET_DIR/$BACKUP_NAME"
tar -czf "$TARGET_DIR/$BACKUP_NAME" -C "$SOURCE_DIR" .

echo "Backup completed successfully."